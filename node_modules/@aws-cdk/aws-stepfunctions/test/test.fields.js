"use strict";
const lib_1 = require("../lib");
module.exports = {
    'deep replace correctly handles fields in arrays'(test) {
        test.deepEqual(lib_1.FieldUtils.renderObject({
            unknown: undefined,
            bool: true,
            literal: 'literal',
            field: lib_1.Data.stringAt('$.stringField'),
            listField: lib_1.Data.listAt('$.listField'),
            deep: [
                'literal',
                {
                    deepField: lib_1.Data.numberAt('$.numField'),
                }
            ]
        }), {
            'bool': true,
            'literal': 'literal',
            'field.$': '$.stringField',
            'listField.$': '$.listField',
            'deep': [
                'literal',
                {
                    'deepField.$': '$.numField'
                }
            ],
        });
        test.done();
    },
    'exercise contextpaths'(test) {
        test.deepEqual(lib_1.FieldUtils.renderObject({
            str: lib_1.Context.stringAt('$$.Execution.StartTime'),
            count: lib_1.Context.numberAt('$$.State.RetryCount'),
            token: lib_1.Context.taskToken,
            entire: lib_1.Context.entireContext
        }), {
            'str.$': '$$.Execution.StartTime',
            'count.$': '$$.State.RetryCount',
            'token.$': '$$.Task.Token',
            'entire.$': '$$'
        });
        test.done();
    },
    'find all referenced paths'(test) {
        test.deepEqual(lib_1.FieldUtils.findReferencedPaths({
            bool: false,
            literal: 'literal',
            field: lib_1.Data.stringAt('$.stringField'),
            listField: lib_1.Data.listAt('$.listField'),
            deep: [
                'literal',
                {
                    field: lib_1.Data.stringAt('$.stringField'),
                    deepField: lib_1.Data.numberAt('$.numField'),
                }
            ]
        }), [
            '$.listField',
            '$.numField',
            '$.stringField',
        ]);
        test.done();
    },
    'cannot have JsonPath fields in arrays'(test) {
        test.throws(() => {
            lib_1.FieldUtils.renderObject({
                deep: [lib_1.Data.stringAt('$.hello')]
            });
        }, /Cannot use JsonPath fields in an array/);
        test.done();
    },
    'datafield path must be correct'(test) {
        test.throws(() => {
            lib_1.Data.stringAt('hello');
        }, /must start with '\$.'/);
        test.done();
    },
    'context path must be correct'(test) {
        test.throws(() => {
            lib_1.Context.stringAt('hello');
        }, /must start with '\$\$.'/);
        test.done();
    },
    'test contains task token'(test) {
        test.equal(true, lib_1.FieldUtils.containsTaskToken({
            field: lib_1.Context.taskToken
        }));
        test.equal(true, lib_1.FieldUtils.containsTaskToken({
            field: lib_1.Context.stringAt('$$.Task'),
        }));
        test.equal(true, lib_1.FieldUtils.containsTaskToken({
            field: lib_1.Context.entireContext
        }));
        test.equal(false, lib_1.FieldUtils.containsTaskToken({
            oops: 'not here'
        }));
        test.equal(false, lib_1.FieldUtils.containsTaskToken({
            oops: lib_1.Context.stringAt('$$.Execution.StartTime')
        }));
        test.done();
    },
    'arbitrary JSONPath fields are not replaced'(test) {
        test.deepEqual(lib_1.FieldUtils.renderObject({
            field: '$.content',
        }), {
            field: '$.content'
        });
        test.done();
    },
    'fields cannot be used somewhere in a string interpolation'(test) {
        test.throws(() => {
            lib_1.FieldUtils.renderObject({
                field: `contains ${lib_1.Data.stringAt('$.hello')}`
            });
        }, /Field references must be the entire string/);
        test.done();
    }
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGVzdC5maWVsZHMuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJ0ZXN0LmZpZWxkcy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQ0EsZ0NBQW1EO0FBRW5ELGlCQUFTO0lBQ1AsaURBQWlELENBQUMsSUFBVTtRQUMxRCxJQUFJLENBQUMsU0FBUyxDQUFDLGdCQUFVLENBQUMsWUFBWSxDQUFDO1lBQ3JDLE9BQU8sRUFBRSxTQUFTO1lBQ2xCLElBQUksRUFBRSxJQUFJO1lBQ1YsT0FBTyxFQUFFLFNBQVM7WUFDbEIsS0FBSyxFQUFFLFVBQUksQ0FBQyxRQUFRLENBQUMsZUFBZSxDQUFDO1lBQ3JDLFNBQVMsRUFBRSxVQUFJLENBQUMsTUFBTSxDQUFDLGFBQWEsQ0FBQztZQUNyQyxJQUFJLEVBQUU7Z0JBQ0osU0FBUztnQkFDVDtvQkFDRSxTQUFTLEVBQUUsVUFBSSxDQUFDLFFBQVEsQ0FBQyxZQUFZLENBQUM7aUJBQ3ZDO2FBQ0Y7U0FDRixDQUFDLEVBQUU7WUFDRixNQUFNLEVBQUUsSUFBSTtZQUNaLFNBQVMsRUFBRSxTQUFTO1lBQ3BCLFNBQVMsRUFBRSxlQUFlO1lBQzFCLGFBQWEsRUFBRSxhQUFhO1lBQzVCLE1BQU0sRUFBRTtnQkFDTixTQUFTO2dCQUNUO29CQUNFLGFBQWEsRUFBRSxZQUFZO2lCQUM1QjthQUNGO1NBQ0YsQ0FBQyxDQUFDO1FBRUgsSUFBSSxDQUFDLElBQUksRUFBRSxDQUFDO0lBQ2QsQ0FBQztJQUVELHVCQUF1QixDQUFDLElBQVU7UUFDaEMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxnQkFBVSxDQUFDLFlBQVksQ0FBQztZQUNyQyxHQUFHLEVBQUUsYUFBTyxDQUFDLFFBQVEsQ0FBQyx3QkFBd0IsQ0FBQztZQUMvQyxLQUFLLEVBQUUsYUFBTyxDQUFDLFFBQVEsQ0FBQyxxQkFBcUIsQ0FBQztZQUM5QyxLQUFLLEVBQUUsYUFBTyxDQUFDLFNBQVM7WUFDeEIsTUFBTSxFQUFFLGFBQU8sQ0FBQyxhQUFhO1NBQzlCLENBQUMs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SUFFRCw0Q0FBNEMsQ0FBQyxJQUFVO1FBQ3JELElBQUksQ0FBQyxTQUFTLENBQUMsZ0JBQVUsQ0FBQyxZQUFZLENBQUM7WUFDckMsS0FBSyxFQUFFLFdBQVc7U0FDbkIsQ0FBQyxFQUFFO1lBQ0YsS0FBSyxFQUFFLFdBQVc7U0FDbkIsQ0FBQyxDQUFDO1FBRUgsSUFBSSxDQUFDLElBQUksRUFBRSxDQUFDO0lBQ2QsQ0FBQztJQUVELDJEQUEyRCxDQUFDLElBQVU7UUFDcEUsSUFBSSxDQUFDLE1BQU0sQ0FBQyxHQUFHLEVBQUU7WUFDZixnQkFBVSxDQUFDLFlBQVksQ0FBQztnQkFDdEIsS0FBSyxFQUFFLFlBQVksVUFBSSxDQUFDLFFBQVEsQ0FBQyxTQUFTLENBQUMsRUFBRTthQUM5QyxDQUFDLENBQUM7UUFDTCxDQUFDLEVBQUUsNENBQTRDLENBQUMsQ0FBQztRQUVqRCxJQUFJLENBQUMsSUFBSSxFQUFFLENBQUM7SUFDZCxDQUFDO0NBQ0YsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFRlc3QgfSBmcm9tICdub2RldW5pdCc7XG5pbXBvcnQgeyBDb250ZXh0LCBEYXRhLCBGaWVsZFV0aWxzIH0gZnJvbSBcIi4uL2xpYlwiO1xuXG5leHBvcnQgPSB7XG4gICdkZWVwIHJlcGxhY2UgY29ycmVjdGx5IGhhbmRsZXMgZmllbGRzIGluIGFycmF5cycodGVzdDogVGVzdCkge1xuICAgIHRlc3QuZGVlcEVxdWFsKEZpZWxkVXRpbHMucmVuZGVyT2JqZWN0KHtcbiAgICAgIHVua25vd246IHVuZGVmaW5lZCxcbiAgICAgIGJvb2w6IHRydWUsXG4gICAgICBsaXRlcmFsOiAnbGl0ZXJhbCcsXG4gICAgICBmaWVsZDogRGF0YS5zdHJpbmdBdCgnJC5zdHJpbmdGaWVsZCcpLFxuICAgICAgbGlzdEZpZWxkOiBEYXRhLmxpc3RBdCgnJC5saXN0RmllbGQnKSxcbiAgICAgIGRlZXA6IFtcbiAgICAgICAgJ2xpdGVyYWwnLFxuICAgICAgICB7XG4gICAgICAgICAgZGVlcEZpZWxkOiBEYXRhLm51bWJlckF0KCckLm51bUZpZWxkJyksXG4gICAgICAgIH1cbiAgICAgIF1cbiAgICB9KSwge1xuICAgICAgJ2Jvb2wnOiB0cnVlLFxuICAgICAgJ2xpdGVyYWwnOiAnbGl0ZXJhbCcsXG4gICAgICAnZmllbGQuJCc6ICckLnN0cmluZ0ZpZWxkJyxcbiAgICAgICdsaXN0RmllbGQuJCc6ICckLmxpc3RGaWVsZCcsXG4gICAgICAnZGVlcCc6IFtcbiAgICAgICAgJ2xpdGVyYWwnLFxuICAgICAgICB7XG4gICAgICAgICAgJ2RlZXBGaWVsZC4kJzogJyQubnVtRmllbGQnXG4gICAgICAgIH1cbiAgICAgIF0sXG4gICAgfSk7XG5cbiAgICB0ZXN0LmRvbmUoKTtcbiAgfSxcblxuICAnZXhlcmNpc2UgY29udGV4dHBhdGhzJyh0ZXN0OiBUZXN0KSB7XG4gICAgdGVzdC5kZWVwRXF1YWwoRmllbGRVdGlscy5yZW5kZXJPYmplY3Qoe1xuICAgICAgc3RyOiBDb250ZXh0LnN0cmluZ0F0KCckJC5FeGVjdXRpb24uU3RhcnRUaW1lJyksXG4gICAgICBjb3VudDogQ29udGV4dC5udW1iZXJBdCgnJCQuU3RhdGUuUmV0cnlDb3VudCcpLFxuICAgICAgdG9rZW46IENvbnRleHQudGFza1Rva2VuLFxuICAgICAgZW50aXJlOiBDb250ZXh0LmVudGlyZUNvbnRleHRcbiAgICB9KSwge1xuICAgICAgJ3N0ci4kJzogJyQkLkV4ZWN1dGlvbi5TdGFydFRpbWUnLFxuICAgICAgJ2NvdW50LiQnOiAnJCQuU3RhdGUuUmV0cnlDb3VudCcsXG4gICAgICAndG9rZW4uJCc6ICckJC5UYXNrLlRva2VuJyxcbiAgICAgICdlbnRpcmUuJCc6ICckJCdcbiAgICB9KTtcblxuICAgIHRlc3QuZG9uZSgpO1xuICB9LFxuXG4gICdmaW5kIGFsbCByZWZlcmVuY2VkIHBhdGhzJyh0ZXN0OiBUZXN0KSB7XG4gICAgdGVzdC5kZWVwRXF1YWwoRmllbGRVdGlscy5maW5kUmVmZXJlbmNlZFBhdGhzKHtcbiAgICAgIGJvb2w6IGZhbHNlLFxuICAgICAgbGl0ZXJhbDogJ2xpdGVyYWwnLFxuICAgICAgZmllbGQ6IERhdGEuc3RyaW5nQXQoJyQuc3RyaW5nRmllbGQnKSxcbiAgICAgIGxpc3RGaWVsZDogRGF0YS5saXN0QXQoJyQubGlzdEZpZWxkJyksXG4gICAgICBkZWVwOiBbXG4gICAgICAgICdsaXRlcmFsJyxcbiAgICAgICAge1xuICAgICAgICAgIGZpZWxkOiBEYXRhLnN0cmluZ0F0KCckLnN0cmluZ0ZpZWxkJyksXG4gICAgICAgICAgZGVlcEZpZWxkOiBEYXRhLm51bWJlckF0KCckLm51bUZpZWxkJyksXG4gICAgICAgIH1cbiAgICAgIF1cbiAgICB9KSwgW1xuICAgICAgJyQubGlzdEZpZWxkJyxcbiAgICAgICckLm51bUZpZWxkJyxcbiAgICAgICckLnN0cmluZ0ZpZWxkJyxcbiAgICBdKTtcblxuICAgIHRlc3QuZG9uZSgpO1xuICB9LFxuXG4gICdjYW5ub3QgaGF2ZSBKc29uUGF0aCBmaWVsZHMgaW4gYXJyYXlzJyh0ZXN0OiBUZXN0KSB7XG4gICAgdGVzdC50aHJvd3MoKCkgPT4ge1xuICAgICAgRmllbGRVdGlscy5yZW5kZXJPYmplY3Qoe1xuICAgICAgICBkZWVwOiBbRGF0YS5zdHJpbmdBdCgnJC5oZWxsbycpXVxuICAgICAgfSk7XG4gICAgfSwgL0Nhbm5vdCB1c2UgSnNvblBhdGggZmllbGRzIGluIGFuIGFycmF5Lyk7XG5cbiAgICB0ZXN0LmRvbmUoKTtcbiAgfSxcblxuICAnZGF0YWZpZWxkIHBhdGggbXVzdCBiZSBjb3JyZWN0Jyh0ZXN0OiBUZXN0KSB7XG4gICAgdGVzdC50aHJvd3MoKCkgPT4ge1xuICAgICAgRGF0YS5zdHJpbmdBdCgnaGVsbG8nKTtcbiAgICB9LCAvbXVzdCBzdGFydCB3aXRoICdcXCQuJy8pO1xuXG4gICAgdGVzdC5kb25lKCk7XG4gIH0sXG5cbiAgJ2NvbnRleHQgcGF0aCBtdXN0IGJlIGNvcnJlY3QnKHRlc3Q6IFRlc3QpIHtcbiAgICB0ZXN0LnRocm93cygoKSA9PiB7XG4gICAgICBDb250ZXh0LnN0cmluZ0F0KCdoZWxsbycpO1xuICAgIH0sIC9tdXN0IHN0YXJ0IHdpdGggJ1xcJFxcJC4nLyk7XG5cbiAgICB0ZXN0LmRvbmUoKTtcbiAgfSxcblxuICAndGVzdCBjb250YWlucyB0YXNrIHRva2VuJyh0ZXN0OiBUZXN0KSB7XG4gICAgdGVzdC5lcXVhbCh0cnVlLCBGaWVsZFV0aWxzLmNvbnRhaW5zVGFza1Rva2VuKHtcbiAgICAgIGZpZWxkOiBDb250ZXh0LnRhc2tUb2tlblxuICAgIH0pKTtcblxuICAgIHRlc3QuZXF1YWwodHJ1ZSwgRmllbGRVdGlscy5jb250YWluc1Rhc2tUb2tlbih7XG4gICAgICBmaWVsZDogQ29udGV4dC5zdHJpbmdBdCgnJCQuVGFzaycpLFxuICAgIH0pKTtcblxuICAgIHRlc3QuZXF1YWwodHJ1ZSwgRmllbGRVdGlscy5jb250YWluc1Rhc2tUb2tlbih7XG4gICAgICBmaWVsZDogQ29udGV4dC5lbnRpcmVDb250ZXh0XG4gICAgfSkpO1xuXG4gICAgdGVzdC5lcXVhbChmYWxzZSwgRmllbGRVdGlscy5jb250YWluc1Rhc2tUb2tlbih7XG4gICAgICBvb3BzOiAnbm90IGhlcmUnXG4gICAgfSkpO1xuXG4gICAgdGVzdC5lcXVhbChmYWxzZSwgRmllbGRVdGlscy5jb250YWluc1Rhc2tUb2tlbih7XG4gICAgICBvb3BzOiBDb250ZXh0LnN0cmluZ0F0KCckJC5FeGVjdXRpb24uU3RhcnRUaW1lJylcbiAgICB9KSk7XG5cbiAgICB0ZXN0LmRvbmUoKTtcbiAgfSxcblxuICAnYXJiaXRyYXJ5IEpTT05QYXRoIGZpZWxkcyBhcmUgbm90IHJlcGxhY2VkJyh0ZXN0OiBUZXN0KSB7XG4gICAgdGVzdC5kZWVwRXF1YWwoRmllbGRVdGlscy5yZW5kZXJPYmplY3Qoe1xuICAgICAgZmllbGQ6ICckLmNvbnRlbnQnLFxuICAgIH0pLCB7XG4gICAgICBmaWVsZDogJyQuY29udGVudCdcbiAgICB9KTtcblxuICAgIHRlc3QuZG9uZSgpO1xuICB9LFxuXG4gICdmaWVsZHMgY2Fubm90IGJlIHVzZWQgc29tZXdoZXJlIGluIGEgc3RyaW5nIGludGVycG9sYXRpb24nKHRlc3Q6IFRlc3QpIHtcbiAgICB0ZXN0LnRocm93cygoKSA9PiB7XG4gICAgICBGaWVsZFV0aWxzLnJlbmRlck9iamVjdCh7XG4gICAgICAgIGZpZWxkOiBgY29udGFpbnMgJHtEYXRhLnN0cmluZ0F0KCckLmhlbGxvJyl9YFxuICAgICAgfSk7XG4gICAgfSwgL0ZpZWxkIHJlZmVyZW5jZXMgbXVzdCBiZSB0aGUgZW50aXJlIHN0cmluZy8pO1xuXG4gICAgdGVzdC5kb25lKCk7XG4gIH1cbn07Il19